package info.nukoneko.android.qritter.twitter;import android.content.Context;import android.content.Intent;import android.net.Uri;import android.os.Bundle;import info.nukoneko.android.qritter.R;import info.nukoneko.android.qritter.common.BaseActivity;import info.nukoneko.android.qritter.util.RxWrap;import info.nukoneko.android.qritter.util.TwitterUtil;import info.nukoneko.android.qritter.util.tools.ShowToast;import twitter4j.Twitter;import twitter4j.auth.RequestToken;/** * Created by TEJNEK on 2016/03/17. */public class TwitterOAuthActivity extends BaseActivity {    private Twitter twitter;    private RequestToken requestToken;    @Override    protected void onCreate(Bundle savedInstanceState) {        super.onCreate(savedInstanceState);        twitter = TwitterUtil.getTwitterInstance(this);        RxWrap.create(RxWrap.createObservable(() -> twitter.getOAuthRequestToken(getString(R.string.twitter_callback_uri))))                .subscribe(_requestToken -> {                    requestToken = _requestToken;                    System.out.print(requestToken.getToken());                    startActivity(new Intent(Intent.ACTION_VIEW, Uri.parse(requestToken.getAuthorizationURL())));                }, Throwable::printStackTrace);    }    @Override    protected void onNewIntent(Intent intent) {        super.onNewIntent(intent);        Uri uri = intent.getData();        if (uri == null ||                !uri.toString().startsWith(getString(R.string.twitter_callback_uri))) {            ShowToast.showToast(R.string.error_unknown);            return;        }        final String verifier = uri.getQueryParameter("oauth_verifier");        if (verifier == null || verifier.length() == 0) {            ShowToast.showToast(R.string.error_need_auth);            return;        }        RxWrap.create(RxWrap.createObservable(() -> twitter.getOAuthAccessToken(requestToken, verifier)))                .subscribe(accessToken -> {                    TwitterUtil.addAccount(getApplicationContext(), accessToken);                    ShowToast.showToast(R.string.success_auth);                    finish();                }, Throwable::printStackTrace);    }    public static void startActivity(Context context) {        context.startActivity(new Intent(context, TwitterOAuthActivity.class));    }}